<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		body{
			display: flex;
			flex-flow: column;
			align-items: center;
		}
		main{
			display: flex;
			margin-block: 2rem;
			flex-flow: column;
			border: 2px solid #04f;
			width: 70%;
			border-radius: 10px;
		}
		main > *{
			padding: 1rem;
		}
		main > h3{
			margin-block: 0;
			background-color: #04f;
			color: white;
		}
	</style>
</head>
<body>
	<h3 id="log" style="display: none;color: red;"></h3>
	
	<script>
		const main = document.querySelector('main');
		const channels = [
			`Rick Astley`,
			`The Night`,
			`See You Again`,
			`Believer`
		]
		async function pull() {
			const data = await fetch(`/all`).then(e=>e.json()).catch(e=>{
				const elem = document.querySelector('#log')
				elem.style.display = 'block';
				elem.append("Server Offline");
				return undefined;
			})
			
			if (!data) return;
			
			const main = document.createElement('main');
			const head = document.createElement('h3');
			const item = document.createElement('div');
			
			Object.entries(data).forEach(( [id,{ history }] )=>{
				const [_main,_head] = [main.cloneNode(),head.cloneNode()];
				_main.appendChild(_head);
				_head.append(id);
				history.forEach(e=>{
					const _item = item.cloneNode();
					let inner = e.join(' : ');
					const channel = channels[inner.match(/\d/)?.[0]];
					inner = inner.replace(/\d/,channel).replace(/-/,'');
					_item.append( inner );
					_main.appendChild(_item)
				})
				document.body.appendChild(_main);
			})
			
		}
		pull();
	</script>
	
</body>
</html>